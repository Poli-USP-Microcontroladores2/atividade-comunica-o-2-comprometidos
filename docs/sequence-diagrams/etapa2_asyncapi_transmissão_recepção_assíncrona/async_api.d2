shape: sequence_diagram

App -> UART_Driver: uart_callback_set
note over UART_Driver: Registra callback assíncrono

loop a cada 5 segundos
    App -> App: sys_rand32_get → define num_tx
    
    loop para cada pacote
        App -> UART_Driver: net_buf_alloc / preenche tx_buf
        App -> UART_Driver: uart_tx(tx_buf)
        
        alt UART livre
            UART_Driver -> UART_Hardware: inicia transmissão
            UART_Hardware -> UART_Driver: UART_TX_DONE
            UART_Driver -> k_fifo: verifica fila e envia próximo buffer
        else UART ocupado
            UART_Driver -> k_fifo: enfileira tx_buf
        end
    end

    App -> UART_Driver: alterna RX enable/disable
    UART_Driver -> UART_Hardware: uart_rx_enable / uart_rx_disable
end

note over UART_Hardware: Interrupções UART geradas

== Eventos assíncronos UART ==

UART_Hardware -> UART_Driver: UART_RX_BUF_REQUEST
UART_Driver -> UART_Hardware: uart_rx_buf_rsp

UART_Hardware -> UART_Driver: UART_RX_RDY
note over UART_Driver: Dados RX recebidos

UART_Hardware -> UART_Driver: UART_TX_DONE
note over UART_Driver: Libera buffer TX e processa fila
